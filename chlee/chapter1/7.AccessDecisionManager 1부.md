<aside>
â— Access Control

---

Authentication(ì¸ì¦)ê³¼ Authorization(ì¸ê°€)ì„ ì•„ìš°ë¥´ëŠ” ê°œë…ì…ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ Authorization ë§Œì„ Access Control ì´ë¼ê³  ë¶€ë¥´ê¸°ë„ í•©ë‹ˆë‹¤.
</aside>
<br>


# AccessDecisionManager

ì´ë¯¸ ì¸ì¦ì„ ê±°ì¹œ ì‚¬ìš©ìê°€ íŠ¹ì •í•œ ì„œë²„ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ì„ í•  ë•Œ (ì›¹ ìš”ì²­, ë©”ì†Œë“œ ì½œ ë“±ë“±) í—ˆìš©í•  ê²ƒì¸ì§€, ìœ íš¨í•œ ìš”ì²­ì¸ í™•ì¸í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ê°€ ë°”ë¡œ **AccessDecisionManager** ì…ë‹ˆë‹¤.
<br>

---

<br>
<aside>
ğŸ“– [ì •ë¦¬]

- ì¸ê°€(Authorization)ë¥¼ í•  ë•ŒëŠ” AccessDecisionManager ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ì¸ì¦(Authentication)ì„ í•  ë•ŒëŠ” AuthenticationManager ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
</aside>
<br>

---

<br>

- AccessDecisionManager ëŠ” ì—¬ëŸ¬ê°œì˜ Voter ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
    ì¦‰, AccessDecisionManager ì•ˆì— ì—¬ëŸ¬ê°œì˜ AccessDecisionVoter ê°€ ëª©ë¡ìœ¼ë¡œ ì­‰ ìˆëŠ”ë° í•˜ë‚˜ì”© ê±°ì¹˜ë©´ì„œ ìœ íš¨í•œì§€ ê°ê° í™•ì¸ì„ í•©ë‹ˆë‹¤.
    
- Authorization ê²°ì •ì„ ë‚´ë¦¬ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ, êµ¬í˜„ì²´ 3ê°€ì§€ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤.
    1. AffirmativeBased
        - ê¸°ë³¸ ì „ëµ
        - ì—¬ëŸ¬ Voterì¤‘ì— í•œëª…ì´ë¼ë„ í—ˆìš©í•˜ë©´ í—ˆìš©
    2. ConsensusBased
        - ë‹¤ìˆ˜ê²°
        - ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
    3. UnanimousBased
        - ë§Œì¥ì¼ì¹˜
        - ëª¨ë“  Voterê°€ í—ˆìš©í•˜ë©´ í—ˆìš©
- í•´ë‹¹í•˜ëŠ” ë¡œì§ì— ë§ì§€ ì•ŠëŠ”ë‹¤ë©´ exception ì´ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´, ê¸°ë³¸ ì „ëµì¸ AffirmativeBased ë¥¼ ì‚¬ìš©í•œë‹¤ê³  í–ˆì„ ë•Œ ì–´ë– í•œ ì´ìœ ì—ì„œë“  ëª¨ë“  Voter ê°€ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ exception ì´ ë°œìƒí•©ë‹ˆë‹¤.

<br>

## ì½”ë“œ ì‚´í´ë³´ê¸°

- AccessDecisionManager ì¸í„°í˜ì´ìŠ¤

```java
public interface AccessDecisionManager {

	//...1
	void decide(Authentication authentication, Object object, Collection<ConfigAttribute> configAttributes)
			throws AccessDeniedException, InsufficientAuthenticationException;

	//...2
	boolean supports(ConfigAttribute attribute);

	boolean supports(Class<?> clazz);
}
```

1. decide
    - AccessDecisionManager ë¥¼ êµ¬í˜„í•  ë•Œ ë°˜ë“œì‹œ êµ¬í˜„í•´ì•¼í•˜ëŠ” ë©”ì†Œë“œì…ë‹ˆë‹¤.
    - ì „ë‹¬ëœ 3ê°€ì§€ ë§¤ê°œë³€ìˆ˜ì— ëŒ€í•´ AccessDecisionManager ê°€ ì‚¬ìš©í•˜ëŠ” Voter ë“¤ì´ ì•¡ì„¸ìŠ¤ ì œì–´ ê²°ì •ì„ í™•ì¸í•©ë‹ˆë‹¤.
        
        ```java
        	void decide(Authentication authentication, Object object, Collection<ConfigAttribute> configAttributes)
        ```
        
        1. authentication
            - ì•ì—ì„œ ë´¤ë˜ Authentication ê°ì²´ ì…ë‹ˆë‹¤.
        2. object
            - í˜¸ì¶œë˜ëŠ” ë³´ì•ˆ ê°ì²´
            - ì˜ˆì‹œ) SecurityConfig
                
                ![Untitled](https://user-images.githubusercontent.com/77683221/234139570-7cb42918-0231-46b7-a22e-6e09e7587453.png)

                
                - â€œ/â€, â€œ/infoâ€ ìš”ì²­ì²˜ëŸ¼ ì ‘ê·¼í•´ì•¼í•  ì˜¤ë¸Œì íŠ¸ì…ë‹ˆë‹¤.
        3. configAttributes
            - í˜¸ì¶œë˜ëŠ” ë³´ì•ˆ ê°ì²´ì™€ ê´€ë ¨ëœ êµ¬ì„± ì†ì„±
            - ì˜ˆì‹œ) SecurityConfig
                
                ![Untitled 1](https://user-images.githubusercontent.com/77683221/234139599-3598f4c1-4f7a-4089-accc-79cc9bbf3f9b.png)

                
                - permitAll, hasRole ê°™ì€ êµ¬ì„± ì†ì„±ì…ë‹ˆë‹¤.
2. supports
    - í•´ë‹¹í•˜ëŠ” ConfigAttribute ë¥¼ ì§€ì›í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ë©”ì†Œë“œ

# AccessDecisionVoter

- í•´ë‹¹ Authenticationì´ íŠ¹ì •í•œ Objectì— ì ‘ê·¼í•  ë•Œ í•„ìš”í•œ ConfigAttributesë¥¼ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
- WebExpressionVoter
    - ì›¹ ì‹œíë¦¬í‹°ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ êµ¬í˜„ì²´, ROLE_Xxxxê°€ ë§¤ì¹˜í•˜ëŠ”ì§€ í™•ì¸.
- RoleHierarchyVoter
    - ê³„ì¸µí˜• ROLE ì§€ì›. ADMIN > MANAGER > USER
- ...

# ë””ë²„ê¹…

AffirmativeBased í´ë˜ìŠ¤ì˜ decide ë©”ì†Œë“œì—ë‹¤ê°€ ë””ë²„ê±°ë¥¼ ê±¸ì–´ë†“ê³  ì–´ë–¤ Voterë¥¼ ì“°ê³  ìˆìœ¼ë©° ì–´ë–»ê²Œ ì§„í–‰ì´ ë˜ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. (ê¸°ë³¸ì „ëµì´ AffirmativeBased ì´ë‹ˆê¹Œìš”)

## Account ë“±ë¡

ë¨¼ì € [http://localhost:8080/account/ADMIN/hello/123](http://localhost:8080/account/ADMIN/hello/123) ë¡œ Accountë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤.

- AffirmativeBased í´ë˜ìŠ¤ > decide ë©”ì†Œë“œ
    
    ![Untitled 2](https://user-images.githubusercontent.com/77683221/234139663-948bf060-1cc4-447c-9d52-2426a44a7c70.png)

    

Accountë¥¼ ë§Œë“¤ ë•Œ voterë¥¼ í™•ì¸í•´ë³´ë©´ WebExpressionVoter ë¼ëŠ” voterê°€ 1ê°œ ë“¤ì–´ìˆìŠµë‹ˆë‹¤.

- getDecisionVoters()
    
    ![Untitled 3](https://user-images.githubusercontent.com/77683221/234139690-3ae31f99-87f6-421b-b564-dfc794e68777.png)

    
- voter
    
    ![Untitled 4](https://user-images.githubusercontent.com/77683221/234139705-2d59077b-a213-4021-9f04-1034bc09c7b7.png)

    

ê·¸ë¦¬ê³  voter ê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ë´…ì‹œë‹¤.

- WebExpressionVoter í´ë˜ìŠ¤ > vote ë©”ì†Œë“œ
    
    ![Untitled 5](https://user-images.githubusercontent.com/77683221/234139726-c68fdb11-ff12-40ee-878b-d6f1d7baa128.png)

    

attributes ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ê·¸ ì•ˆì—ëŠ” permitAll ì´ ë“¤ì–´ìˆìŠµë‹ˆë‹¤.

- Collection< ConfigAttribute > attributes
    
    ![Untitled 6](https://user-images.githubusercontent.com/77683221/234139758-e7e8d9c9-b313-48c7-8311-7e332d7d23a5.png)

    

ê·¸ë¦¬ê³  expressionHandler ë¡œ ì§€ì›í•˜ëŠ” ì—¬ë¶€ë¥¼ íŒë‹¨í•´ì„œ ê°’ì„ ë¦¬í„´í•©ë‹ˆë‹¤.

ë‹¤ì‹œ AffirmativeBased í´ë˜ìŠ¤ì˜ decide ë©”ì†Œë“œ ëŒì•„ì˜µì‹œë‹¤.

ì´ ë•Œ resultì—ëŠ” 1ì´ ë¦¬í„´ë©ë‹ˆë‹¤.

![Untitled 7](https://user-images.githubusercontent.com/77683221/234139884-037062cb-7878-4c1b-8426-862561d269e2.png)


ë¦¬í„´í•œ ê°’ì´ 1ì´ë‹ˆê¹Œ í—ˆìš©í•œë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.

ê·¸ë˜ì„œ Accountê°€ ë“±ë¡ë˜ê³  JSONì´ ë°˜í™˜ë©ë‹ˆë‹¤.

<br>
<aside>
â— ë¦¬í„´ ê°’ì€ 1, 0, -1ì´ ë‚˜ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Untitled 8](https://user-images.githubusercontent.com/77683221/234139916-a77dd997-9096-40d4-bebf-a81f740ec51a.png)

- `ACCESS_GRANTED` : í—ˆìš©í•œë‹¤.
- `ACCESS_ABSTAIN` : ì˜ ëª¨ë¥´ê² ë‹¤.
- `ACCESS_DENIED` : ê±°ë¶€í•œë‹¤.
</aside>
<br>

## ëŒ€ì‹œë³´ë“œ ì ‘ê·¼

Accountë¥¼ ë§Œë“¤ì—ˆìœ¼ë‹ˆ ëŒ€ì‹œë³´ë“œ([http://localhost:8080/dashboard](http://localhost:8080/dashboard))ì— ì ‘ê·¼í•´ë³¼ê¹Œìš”? (ì‹œíë¦¬í‹° ì„¤ì •ì—ì„œ ëŒ€ì‹œë³´ë“œëŠ” ì¸ì¦ì´ í•„ìš”í•˜ê²Œ ì„¤ì •ì„ í–ˆìŠµë‹ˆë‹¤.)

ì´ ë•Œ [result](https://www.notion.so/AccessDecisionManager-1-49d75f4adcd0451885141e8b038b6685)ì—ëŠ” -1ì´ ë°˜í™˜ë©ë‹ˆë‹¤.

![Untitled 9](https://user-images.githubusercontent.com/77683221/234139943-f9351615-9645-4c5e-be73-101ad57caf59.png)


ìƒê°í•´ë³´ë©´ ë‹¹ì—°í•©ë‹ˆë‹¤. /dashboardì— ì ‘ê·¼í•˜ë ¤ë©´ ì¸ì¦ëœ ì‚¬ìš©ìê°€ í•„ìš”í•œë° í˜„ì¬ ë¡œê·¸ì¸ì„ ì•ˆí–ˆê¸° ë•Œë¬¸ì— -1ì´ ë°˜í™˜ë˜ì–´ ê±°ë¶€ëœ ê²ƒì´ì£ .

ë¡œê·¸ì¸ì„ í•´ë´…ì‹œë‹¤.

ê·¸ëŸ¼ ìƒì„±í•œ Accountë¡œ ë¡œê·¸ì¸ì„ í•˜ë©´ ì¸ì¦ì´ ë˜ì—ˆìœ¼ë‹ˆ 1ì´ ë°˜í™˜ë  ê²ë‹ˆë‹¤.

![Untitled 10](https://user-images.githubusercontent.com/77683221/234139954-0a3886f3-c063-46bf-aa68-bf4026ac8385.png)