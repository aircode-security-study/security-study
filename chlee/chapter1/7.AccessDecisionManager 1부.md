Access Control ì„ ë‹¤ë£¨ëŠ” ì¸í„°í˜ì´ìŠ¤ ì¤‘ì‹¬ìœ¼ë¡œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

<aside>
â— Access Control

---

Authentication(ì¸ì¦)ê³¼ Authorization(ì¸ê°€)ì„ ì•„ìš°ë¥´ëŠ” ê°œë…ì…ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ Authorization ë§Œì„ Access Control ì´ë¼ê³  ë¶€ë¥´ê¸°ë„ í•©ë‹ˆë‹¤.

</aside>

# AccessDecisionManager

ì´ë¯¸ ì¸ì¦ì„ ê±°ì¹œ ì‚¬ìš©ìê°€ íŠ¹ì •í•œ ì„œë²„ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ì„ í•  ë•Œ (ì›¹ ìš”ì²­, ë©”ì†Œë“œ ì½œ ë“±ë“±) í—ˆìš©í•  ê²ƒì¸ì§€, ìœ íš¨í•œ ìš”ì²­ì¸ í™•ì¸í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ê°€ ë°”ë¡œ **AccessDecisionManager** ì…ë‹ˆë‹¤.

<aside>
ğŸ“– [ì •ë¦¬]

- ì¸ê°€(Authorization)ë¥¼ í•  ë•ŒëŠ” AccessDecisionManager ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ì¸ì¦(Authentication)ì„ í•  ë•ŒëŠ” [AuthenticationManager](https://www.notion.so/AuthenticationManager-Authentication-e2d634004a0340299192556d0bab6940) ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
</aside>

- AccessDecisionManager ëŠ” ì—¬ëŸ¬ê°œì˜ Voter ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
    ì¦‰, AccessDecisionManager ì•ˆì— ì—¬ëŸ¬ê°œì˜ [AccessDecisionVoter](https://www.notion.so/AccessDecisionManager-1-49d75f4adcd0451885141e8b038b6685) ê°€ ëª©ë¡ìœ¼ë¡œ ì­‰ ìˆëŠ”ë° í•˜ë‚˜ì”© ê±°ì¹˜ë©´ì„œ ìœ íš¨í•œì§€ ê°ê° í™•ì¸ì„ í•©ë‹ˆë‹¤.
    
    â†’ [ìì„¸íˆ](https://www.notion.so/AccessDecisionManager-1-49d75f4adcd0451885141e8b038b6685)
    
- Authorization ê²°ì •ì„ ë‚´ë¦¬ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ, êµ¬í˜„ì²´ 3ê°€ì§€ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤.
    1. AffirmativeBased
        - ê¸°ë³¸ ì „ëµ
        - ì—¬ëŸ¬ Voterì¤‘ì— í•œëª…ì´ë¼ë„ í—ˆìš©í•˜ë©´ í—ˆìš©
    2. ConsensusBased
        - ë‹¤ìˆ˜ê²°
        - ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
    3. UnanimousBased
        - ë§Œì¥ì¼ì¹˜
        - ëª¨ë“  Voterê°€ í—ˆìš©í•˜ë©´ í—ˆìš©
- í•´ë‹¹í•˜ëŠ” ë¡œì§ì— ë§ì§€ ì•ŠëŠ”ë‹¤ë©´ exception ì´ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´, ê¸°ë³¸ ì „ëµì¸ AffirmativeBased ë¥¼ ì‚¬ìš©í•œë‹¤ê³  í–ˆì„ ë•Œ ì–´ë– í•œ ì´ìœ ì—ì„œë“  ëª¨ë“  Voter ê°€ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ exception ì´ ë°œìƒí•©ë‹ˆë‹¤.
    
    > [ì°¸ê³ ]
    > 
    > 
    >  AuthenticationManager ë„ ë§ˆì°¬ê°€ì§€ ì…ë‹ˆë‹¤. ì¸ì¦ì´ ìœ íš¨í•œì§€ í™•ì¸í•˜ëŠ”ë° ìœ íš¨í•˜ì§€ ì•Šë‹¤ë©´ ì—ëŸ¬ë¥¼ ë˜ì§‘ë‹ˆë‹¤. â†’ [ìì„¸íˆ](https://www.notion.so/AuthenticationManager-Authentication-e2d634004a0340299192556d0bab6940)
    > 
    
    > AccessDecisionManager ì™€ AuthenticationManager ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ” ë’¤ì—ì„œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.
    > 

## ì½”ë“œ ì‚´í´ë³´ê¸°

- AccessDecisionManager ì¸í„°í˜ì´ìŠ¤

```java
public interface AccessDecisionManager {

	//...1
	void decide(Authentication authentication, Object object, Collection<ConfigAttribute> configAttributes)
			throws AccessDeniedException, InsufficientAuthenticationException;

	//...2
	boolean supports(ConfigAttribute attribute);

	boolean supports(Class<?> clazz);
}
```

1. decide
    - AccessDecisionManager ë¥¼ êµ¬í˜„í•  ë•Œ ë°˜ë“œì‹œ êµ¬í˜„í•´ì•¼í•˜ëŠ” ë©”ì†Œë“œì…ë‹ˆë‹¤.
        
        > êµ¬í˜„ëœ ë©”ì†Œë“œëŠ” [ë’¤ì—ì„œ ë””ë²„ê¹…í•  ë•Œ](https://www.notion.so/AccessDecisionManager-1-49d75f4adcd0451885141e8b038b6685) ì‚´í´ë´…ì‹œë‹¤. (ê¸°ë³¸ ì „ëµì¸ AffirmativeBased ë¡œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.)
        > 
    - ì „ë‹¬ëœ 3ê°€ì§€ ë§¤ê°œë³€ìˆ˜ì— ëŒ€í•´ AccessDecisionManager ê°€ ì‚¬ìš©í•˜ëŠ” Voter ë“¤ì´ ì•¡ì„¸ìŠ¤ ì œì–´ ê²°ì •ì„ í™•ì¸í•©ë‹ˆë‹¤.
        
        ```java
        	void decide(Authentication authentication, Object object, Collection<ConfigAttribute> configAttributes)
        ```
        
        1. authentication
            - ì•ì—ì„œ ë´¤ë˜ [Authentication](https://www.notion.so/SecurityContextHolder-Authentication-e8f22ba68e6c4a29ac988af93f86287b) ê°ì²´ ì…ë‹ˆë‹¤.
        2. object
            - í˜¸ì¶œë˜ëŠ” ë³´ì•ˆ ê°ì²´
            - ì˜ˆì‹œ) SecurityConfig
                
                ![Untitled](%5B%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%B5%E1%84%8F%E1%85%B2%E1%84%85%E1%85%B5%E1%84%90%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%5D%20AccessDecisionManager%2049d75f4adcd0451885141e8b038b6685/Untitled.png)
                
                - â€œ/â€, â€œ/infoâ€ ìš”ì²­ì²˜ëŸ¼ ì ‘ê·¼í•´ì•¼í•  ì˜¤ë¸Œì íŠ¸ì…ë‹ˆë‹¤.
        3. configAttributes
            - í˜¸ì¶œë˜ëŠ” ë³´ì•ˆ ê°ì²´ì™€ ê´€ë ¨ëœ êµ¬ì„± ì†ì„±
            - ì˜ˆì‹œ) SecurityConfig
                
                ![Untitled](%5B%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%B5%E1%84%8F%E1%85%B2%E1%84%85%E1%85%B5%E1%84%90%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%5D%20AccessDecisionManager%2049d75f4adcd0451885141e8b038b6685/Untitled%201.png)
                
                - permitAll, hasRole ê°™ì€ êµ¬ì„± ì†ì„±ì…ë‹ˆë‹¤.
2. supports
    - í•´ë‹¹í•˜ëŠ” ConfigAttribute ë¥¼ ì§€ì›í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ë©”ì†Œë“œ

# AccessDecisionVoter

- í•´ë‹¹ Authenticationì´ íŠ¹ì •í•œ Objectì— ì ‘ê·¼í•  ë•Œ í•„ìš”í•œ ConfigAttributesë¥¼ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
- WebExpressionVoter
    - ì›¹ ì‹œíë¦¬í‹°ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ êµ¬í˜„ì²´, ROLE_Xxxxê°€ ë§¤ì¹˜í•˜ëŠ”ì§€ í™•ì¸.
        
        > ìì„¸í•œê±´ ë””ë²„ê¹…ì„ í•˜ë©´ì„œ ë´…ì‹œë‹¤.
        > 
- RoleHierarchyVoter
    - ê³„ì¸µí˜• ROLE ì§€ì›. ADMIN > MANAGER > USER
- ...

# ë””ë²„ê¹…

AffirmativeBased í´ë˜ìŠ¤ì˜ decide ë©”ì†Œë“œì—ë‹¤ê°€ ë””ë²„ê±°ë¥¼ ê±¸ì–´ë†“ê³  ì–´ë–¤ Voterë¥¼ ì“°ê³  ìˆìœ¼ë©° ì–´ë–»ê²Œ ì§„í–‰ì´ ë˜ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. (ê¸°ë³¸ì „ëµì´ AffirmativeBased ì´ë‹ˆê¹Œìš”)

## Account ë“±ë¡

ë¨¼ì € [http://localhost:8080/account/ADMIN/hello/123](http://localhost:8080/account/ADMIN/hello/123) ë¡œ Accountë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤.

- AffirmativeBased í´ë˜ìŠ¤ > decide ë©”ì†Œë“œ
    
    ![Untitled](%5B%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%B5%E1%84%8F%E1%85%B2%E1%84%85%E1%85%B5%E1%84%90%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%5D%20AccessDecisionManager%2049d75f4adcd0451885141e8b038b6685/Untitled%202.png)
    

Accountë¥¼ ë§Œë“¤ ë•Œ voterë¥¼ í™•ì¸í•´ë³´ë©´ WebExpressionVoter ë¼ëŠ” voterê°€ 1ê°œ ë“¤ì–´ìˆìŠµë‹ˆë‹¤.

- getDecisionVoters()
    
    ![Untitled](%5B%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%B5%E1%84%8F%E1%85%B2%E1%84%85%E1%85%B5%E1%84%90%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%5D%20AccessDecisionManager%2049d75f4adcd0451885141e8b038b6685/Untitled%203.png)
    
- voter
    
    ![Untitled](%5B%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%B5%E1%84%8F%E1%85%B2%E1%84%85%E1%85%B5%E1%84%90%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%5D%20AccessDecisionManager%2049d75f4adcd0451885141e8b038b6685/Untitled%204.png)
    

ê·¸ë¦¬ê³  voter ê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ë´…ì‹œë‹¤.

- WebExpressionVoter í´ë˜ìŠ¤ > vote ë©”ì†Œë“œ
    
    ![Untitled](%5B%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%B5%E1%84%8F%E1%85%B2%E1%84%85%E1%85%B5%E1%84%90%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%5D%20AccessDecisionManager%2049d75f4adcd0451885141e8b038b6685/Untitled%205.png)
    

attributes ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ê·¸ ì•ˆì—ëŠ” permitAll ì´ ë“¤ì–´ìˆìŠµë‹ˆë‹¤.

- Collection<ConfigAttribute> attributes
    
    ![Untitled](%5B%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%B5%E1%84%8F%E1%85%B2%E1%84%85%E1%85%B5%E1%84%90%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%5D%20AccessDecisionManager%2049d75f4adcd0451885141e8b038b6685/Untitled%206.png)
    

ê·¸ë¦¬ê³  expressionHandler ë¡œ ì§€ì›í•˜ëŠ” ì—¬ë¶€ë¥¼ íŒë‹¨í•´ì„œ ê°’ì„ ë¦¬í„´í•©ë‹ˆë‹¤.

ë‹¤ì‹œ AffirmativeBased í´ë˜ìŠ¤ì˜ decide ë©”ì†Œë“œ ëŒì•„ì˜µì‹œë‹¤.

ì´ ë•Œ resultì—ëŠ” 1ì´ ë¦¬í„´ë©ë‹ˆë‹¤.

![Untitled](%5B%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%B5%E1%84%8F%E1%85%B2%E1%84%85%E1%85%B5%E1%84%90%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%5D%20AccessDecisionManager%2049d75f4adcd0451885141e8b038b6685/Untitled%207.png)

ë¦¬í„´í•œ ê°’ì´ 1ì´ë‹ˆê¹Œ í—ˆìš©í•œë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.

ê·¸ë˜ì„œ Accountê°€ ë“±ë¡ë˜ê³  JSONì´ ë°˜í™˜ë©ë‹ˆë‹¤.

<aside>
â— ë¦¬í„´ ê°’ì€ 1, 0, -1ì´ ë‚˜ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Untitled](%5B%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%B5%E1%84%8F%E1%85%B2%E1%84%85%E1%85%B5%E1%84%90%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%5D%20AccessDecisionManager%2049d75f4adcd0451885141e8b038b6685/Untitled%208.png)

- `ACCESS_GRANTED` : í—ˆìš©í•œë‹¤.
- `ACCESS_ABSTAIN` : ì˜ ëª¨ë¥´ê² ë‹¤.
- `ACCESS_DENIED` : ê±°ë¶€í•œë‹¤.
</aside>

## ëŒ€ì‹œë³´ë“œ ì ‘ê·¼

Accountë¥¼ ë§Œë“¤ì—ˆìœ¼ë‹ˆ ëŒ€ì‹œë³´ë“œ([http://localhost:8080/dashboard](http://localhost:8080/dashboard))ì— ì ‘ê·¼í•´ë³¼ê¹Œìš”? (ì‹œíë¦¬í‹° ì„¤ì •ì—ì„œ ëŒ€ì‹œë³´ë“œëŠ” ì¸ì¦ì´ í•„ìš”í•˜ê²Œ ì„¤ì •ì„ í–ˆìŠµë‹ˆë‹¤.)

ì´ ë•Œ [result](https://www.notion.so/AccessDecisionManager-1-49d75f4adcd0451885141e8b038b6685)ì—ëŠ” -1ì´ ë°˜í™˜ë©ë‹ˆë‹¤.

![Untitled](%5B%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%B5%E1%84%8F%E1%85%B2%E1%84%85%E1%85%B5%E1%84%90%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%5D%20AccessDecisionManager%2049d75f4adcd0451885141e8b038b6685/Untitled%209.png)

ìƒê°í•´ë³´ë©´ ë‹¹ì—°í•©ë‹ˆë‹¤. /dashboardì— ì ‘ê·¼í•˜ë ¤ë©´ ì¸ì¦ëœ ì‚¬ìš©ìê°€ í•„ìš”í•œë° í˜„ì¬ ë¡œê·¸ì¸ì„ ì•ˆí–ˆê¸° ë•Œë¬¸ì— -1ì´ ë°˜í™˜ë˜ì–´ ê±°ë¶€ëœ ê²ƒì´ì£ .

ë¡œê·¸ì¸ì„ í•´ë´…ì‹œë‹¤.

ê·¸ëŸ¼ ìƒì„±í•œ Accountë¡œ ë¡œê·¸ì¸ì„ í•˜ë©´ ì¸ì¦ì´ ë˜ì—ˆìœ¼ë‹ˆ 1ì´ ë°˜í™˜ë  ê²ë‹ˆë‹¤.

![Untitled](%5B%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%B5%E1%84%8F%E1%85%B2%E1%84%85%E1%85%B5%E1%84%90%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%5D%20AccessDecisionManager%2049d75f4adcd0451885141e8b038b6685/Untitled%2010.png)

ì—¬ê¸°ê¹Œì§€ ë””ë²„ê±°ë¥¼ ì°ì–´ì„œ ë´¤ëŠ”ë°, AccessDecisionVoter ê°€ ì–´ë–»ê²Œ Voter ë¥¼ í™œìš©í•˜ê³  ìˆëŠ”ì§€ ì˜ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í˜„ì¬ëŠ” Voter ê°€ í•˜ë‚˜ë°–ì— ì—†ëŠ”ë° ì–´ë–»ê²Œ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì„ í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•´ë´…ì‹œë‹¤.